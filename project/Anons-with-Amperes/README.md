# âš¡ Proof of Charge â€” Verifiable Energy Settlement Using Zero-Knowledge Proofs

**Proof of Charge** is a zero-knowledge circuit that verifies electric-meter readings and calculates fair energy costs â€” without revealing sensitive usage data.
It provides transparent, privacy-preserving billing for **EV charging stations**, **IoT devices**, or **smart-meter networks**.

Built with **Circom 2.0**, **snarkjs**, and **TypeScript**, this project demonstrates how energy consumption and pricing logic can be proven cryptographically and verified on-chain (e.g., **Solana** or **Ethereum**).

---

## ğŸš€ Key Idea

Electric charging services today require users to trust a central operatorâ€™s metering and pricing logic.
**Proof of Charge** eliminates that trust requirement by generating a zero-knowledge proof that:

* âœ… Confirms `meter_end_wh â‰¥ meter_start_wh + 1`
* âš¡ Computes total energy used (`energy_used_wh`)
* ğŸ’° Calculates the amount owed
  (`amount_paise = ceil(energy_used_wh Ã— rate / 1000)`)
* ğŸ” Produces a verifiable proof that can be checked publicly â€” without revealing the actual meter readings.

---

## ğŸ§© Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   charge_point_sample.json â”‚  â† metadata & pricing info
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
     make_input_from_json.ts
     â†’ generates `data/input.json`
             â”‚
             â–¼
   build_proof_of_charge.sh
   â†’ compiles circuit
   â†’ runs Powers of Tau
   â†’ generates proof & verification key
             â”‚
             â–¼
   snarkjs groth16 verify âœ…
   â†’ Proof verified successfully!
```

---

## âš™ï¸ Tech Stack

* ğŸ§  **Circom 2.0** â€“ arithmetic circuit compiler
* ğŸ” **snarkjs** â€“ Groth16 setup, proof generation & verification
* âš¡ **Node.js / TypeScript** â€“ witness generation scripts
* ğŸ’° **circomlib / circomlibjs** â€“ standard constraints & utilities
* ğŸŒ **Solana integration** ready via `@jayanth-kumar-morem/snarkjs-to-solana`

---

## ğŸ“‚ Project Structure

```
anons-with-amperes/
â”‚
â”œâ”€â”€ circuits/
â”‚   â””â”€â”€ proof_of_charge.circom       # Core circuit logic
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ make_input_from_json.ts      # Generates circuit input.json
â”‚   â””â”€â”€ build_proof_of_charge.sh     # Builds, proves, verifies
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ charge_point_sample.json     # Example charger data
â”‚   â””â”€â”€ input.json                   # Generated circuit input
â”‚
â””â”€â”€ build/                           # Auto-generated by build script
```

---

## ğŸ§ª How to Run

### 1. Install Dependencies

```bash
npm install
```

### 2. Generate Circuit Input

```bash
npx ts-node scripts/make_input_from_json.ts \
  --json ./data/charge_point_sample.json \
  --code BERSTD34 \
  --connector C1 \
  --meterStart 1200345 \
  --meterEnd 1202780 \
  --out ./data/input.json
```

âœ… **Output:**

`data/input.json` (contains `meter_start_wh`, `meter_end_wh`, `rate_paise_per_kwh`, `q`, `r`)

---

### 3. Compile & Prove

```bash
chmod +x scripts/build_proof_of_charge.sh
./scripts/build_proof_of_charge.sh
```

This will:

* Compile the circuit
* Run Powers of Tau
* Generate witness & proof
* Verify the proof âœ…

---

## ğŸ§¾ Example Output

```
ğŸ§  Calculating witness...
ğŸ” Generating proof...
ğŸ§¾ Verifying proof...
âœ… All done! Proof verified successfully.
```

---

## ğŸ” Example Input (`data/input.json`)

```json
{
  "meter_start_wh": 1200345,
  "meter_end_wh": 1202780,
  "rate_paise_per_kwh": 1900,
  "q": 4627,
  "r": 499
}
```

---

## ğŸ§  License

MIT Â© 2025 Anons with Amperes

