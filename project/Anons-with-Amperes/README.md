# ⚡ Proof of Charge — Verifiable Energy Settlement Using Zero-Knowledge Proofs

**Proof of Charge** is a zero-knowledge circuit that verifies electric-meter readings and calculates fair energy costs — without revealing sensitive usage data.
It provides transparent, privacy-preserving billing for **EV charging stations**, **IoT devices**, or **smart-meter networks**.

Built with **Circom 2.0**, **snarkjs**, and **TypeScript**, this project demonstrates how energy consumption and pricing logic can be proven cryptographically and verified on-chain (e.g., **Solana** or **Ethereum**).

---

## 🚀 Key Idea

Electric charging services today require users to trust a central operator’s metering and pricing logic.
**Proof of Charge** eliminates that trust requirement by generating a zero-knowledge proof that:

* ✅ Confirms `meter_end_wh ≥ meter_start_wh + 1`
* ⚡ Computes total energy used (`energy_used_wh`)
* 💰 Calculates the amount owed
  (`amount_paise = ceil(energy_used_wh × rate / 1000)`)
* 🔐 Produces a verifiable proof that can be checked publicly — without revealing the actual meter readings.

---

## 🧩 Architecture Overview

```
┌──────────────────────────┐
│   charge_point_sample.json │  ← metadata & pricing info
└────────────┬─────────────┘
             │
             ▼
     make_input_from_json.ts
     → generates `data/input.json`
             │
             ▼
   build_proof_of_charge.sh
   → compiles circuit
   → runs Powers of Tau
   → generates proof & verification key
             │
             ▼
   snarkjs groth16 verify ✅
   → Proof verified successfully!
```

---

## ⚙️ Tech Stack

* 🧠 **Circom 2.0** – arithmetic circuit compiler
* 🔐 **snarkjs** – Groth16 setup, proof generation & verification
* ⚡ **Node.js / TypeScript** – witness generation scripts
* 💰 **circomlib / circomlibjs** – standard constraints & utilities
* 🌐 **Solana integration** ready via `@jayanth-kumar-morem/snarkjs-to-solana`

---

## 📂 Project Structure

```
anons-with-amperes/
│
├── circuits/
│   └── proof_of_charge.circom       # Core circuit logic
│
├── scripts/
│   ├── make_input_from_json.ts      # Generates circuit input.json
│   └── build_proof_of_charge.sh     # Builds, proves, verifies
│
├── data/
│   ├── charge_point_sample.json     # Example charger data
│   └── input.json                   # Generated circuit input
│
└── build/                           # Auto-generated by build script
```

---

## 🧪 How to Run

### 1. Install Dependencies

```bash
npm install
```

### 2. Generate Circuit Input

```bash
npx ts-node scripts/make_input_from_json.ts \
  --json ./data/charge_point_sample.json \
  --code BERSTD34 \
  --connector C1 \
  --meterStart 1200345 \
  --meterEnd 1202780 \
  --out ./data/input.json
```

✅ **Output:**

`data/input.json` (contains `meter_start_wh`, `meter_end_wh`, `rate_paise_per_kwh`, `q`, `r`)

---

### 3. Compile & Prove

```bash
chmod +x scripts/build_proof_of_charge.sh
./scripts/build_proof_of_charge.sh
```

This will:

* Compile the circuit
* Run Powers of Tau
* Generate witness & proof
* Verify the proof ✅

---

## 🧾 Example Output

```
🧠 Calculating witness...
🔐 Generating proof...
🧾 Verifying proof...
✅ All done! Proof verified successfully.
```

---

## 🔍 Example Input (`data/input.json`)

```json
{
  "meter_start_wh": 1200345,
  "meter_end_wh": 1202780,
  "rate_paise_per_kwh": 1900,
  "q": 4627,
  "r": 499
}
```

---

## 🧠 License

MIT © 2025 Anons with Amperes

